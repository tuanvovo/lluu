<!DOCTYPE html>
<html lang="vi">
<head>


<script>
    // B·∫¢O V·ªÜ: N·∫øu ch∆∞a ƒëƒÉng nh·∫≠p, chuy·ªÉn h∆∞·ªõng v·ªÅ index.html
    // (ƒê·∫£m b·∫£o ƒë√£ nh√∫ng th∆∞ vi·ªán Firebase n·∫øu b·∫°n d√πng n√≥)

    if (localStorage.getItem('isLoggedIn') !== 'true') {
        // *** ƒê√É S·ª¨A: login.html -> index.html ***
        window.location.replace('index.html'); 
    }
</script>    
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ƒêi·ªÅu Khi·ªÉn T∆∞·ªõi C√¢y</title>
<link rel="stylesheet" href="css/style.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/js/all.min.js"></script>
<style>
/* GI·ªÆ NGUY√äN CSS */
html, body {margin:0; padding:0; min-height:100vh; background:#fcf6f0;}



.mobile-container {max-width:420px; margin:20px auto; border-radius:0px; background:#fff; box-shadow:0 0 15px rgba(0,0,0,0.2);}



.sub-header {
    padding:15px 20px; 
    display:flex; 
    align-items:center; 
    /* üî• ƒê√É S·ª¨A: D√πng m√†u T√≠m l√†m ch·ªß ƒë·∫°o, chuy·ªÉn d·∫ßn sang Tr·∫Øng/R·∫•t nh·∫°t */
    /* 90deg nghƒ©a l√† chuy·ªÉn m√†u t·ª´ Tr√°i sang Ph·∫£i */
 background: #CFE3EE;
    color:#333; /* Chuy·ªÉn m√†u ch·ªØ sang ƒêen ƒë·∫≠m ƒë·ªÉ d·ªÖ ƒë·ªçc tr√™n n·ªÅn s√°ng */
    
    border-radius: 0;
}


.sub-header h3 {flex-grow:1; text-align:center; margin:0;}
.back {cursor:pointer;}
.main-card {padding:20px; margin:10px; border-radius:0px; background:#fff; box-shadow:0 5px 20px rgba(0,0,0,0.1);}
.image-container {display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:20px;}
.plant-image {width:60%; height:150px; object-fit:cover; border-radius:0px; transition:all 0.3s ease;}



/* N√∫t ƒëi·ªÅu khi·ªÉn */
/* N√∫t ƒëi·ªÅu khi·ªÉn n·ªïi b·∫≠t */
.control-btn {
    border-radius: 0px;                  /* Bo tr√≤n ƒë·∫πp */
    font-weight: bold;
    cursor: pointer;
    padding: 10px 16px;
    transition: all 0.3s ease;
    box-shadow: 0 6px 12px rgba(0,0,0,0.25); /* B√≥ng n·ªïi b·∫≠t */
    color: white;
    font-size: 12px;
}





/* Khi nh·∫•n */
.control-btn:active {
    transform: scale(0.95);
    box-shadow: 0 3px 6px rgba(0,0,0,0.2);
}

/* ON - m√†u xanh gradient */
.control-btn[style*="background-color: #4CAF50"] {
    background: linear-gradient(135deg, #4CAF50, #28a745);
}

/* OFF - m√†u x√°m gradient */
.control-btn[style*="background-color: gray"] {
    background: linear-gradient(135deg, #888888, #555555);
}


/* thanh xanh hen gio*/

#nextScheduleText {
    font-weight: bold;
    font-size: 16px;
    color: white;
    text-align: center;
    padding: 10px 0;
    border-radius: 5px;
    background: linear-gradient(135deg, #4DA0FF, #0077CC);
    box-shadow: 0 5px 12px rgba(0,0,0,0.25);
    transition: all 0.3s ease;
}

/* Khi hover n·ªïi b·∫≠t h∆°n */
#nextScheduleText:hover {
    transform: scale(1.05);
    box-shadow: 0 7px 14px rgba(0,0,0,0.35);
}



.metric-card {width:48%; padding:15px; border-radius:0px; margin-bottom:15px; color:white; font-weight:bold; box-shadow:0 4px 8px rgba(0,0,0,0.15);}




</style>
</head>
<body>
<div class="mobile-container">
  <div class="sub-header">
   <div class="back" onclick="window.location.href='home.html'">&#8592;</div> 
    <h3>ƒêi·ªÅu Khi·ªÉn T∆∞·ªõi C√¢y</h3>
  </div>


  <div class="main-card">


    
    <div class="image-container" style="justify-content: space-around; align-items:center; gap: 15px; margin-bottom: 25px;">
       




           <div class="video-display-container">
            <video id="waterVideo" width="100%" height="100%" muted loop style="object-fit:cover; border-radius:0px;
                box-shadow: 0 4px 10px rgba(0,0,0,0.1);"preload="auto">
                <source src="video/lan.mp4" type="video/mp4">
                Tr√¨nh duy·ªát c·ªßa b·∫°n kh√¥ng h·ªó tr·ª£ video.
            </video>
        </div>





           

        <div style="display:flex; flex-direction:column; gap:16px; width:15%; align-items:flex-end;">
             
            <button id="waterBtn" class="control-btn" 
                    style="width:100%; padding:8px 10px; font-size:12px; background:gray; height: 40px;" 
                    onclick="toggleWater()">OFF</button>
                    
            <button id="checkStatusBtn" class="control-btn" 
                    style="width:100%; padding:8px 10px; font-size:12px; background:#004c8c; height: 40px;" 
                    onclick="getStatus()">XEM</button>

            <p style="margin:0; font-size:14px; color:gray; text-align:right;">
                Tr·∫°ng th√°i: <span id="waterStatusText" style="font-weight: bold;">ƒê√É T·∫ÆT</span>
            </p>
        </div>





     </div>


    <h3 style="color:#333; border-bottom:2px solid #eee; padding-bottom:5px; margin-top:20px;">Th√¥ng s·ªë & Video C·ªë ƒê·ªãnh</h3>
    
   <div style="display:flex; justify-content:center; margin-bottom: 25px; padding-top: 10px;">
    <video width="100%" height="180px" autoplay loop controls 
           style="width: 100%; object-fit: cover;">
        <source src="img/hoanui.mp4" type="video/mp4">
        Tr√¨nh duy·ªát c·ªßa b·∫°n kh√¥ng h·ªó tr·ª£ video.
    </video>
</div>
    <div style="display:flex; flex-wrap:wrap; justify-content:space-between;">
        </div>
 

        <div style="display:flex; flex-wrap:wrap; justify-content:space-between;">
           <div class="metric-card" 
     style="background: linear-gradient(135deg, #bebccf, #fefffe); color: #333; box-shadow:0 6px 12px rgba(128, 200, 208, 0.25);">     <p style="margin:0;">ƒê·ªô ·∫©m ƒê·∫•t üíß</p>
               <h2 style="margin:5px 0 0;">65%</h2>
            </div>

           <div class="metric-card" style="background: linear-gradient(135deg, #f3c27d, #fac17b);">
            <p style="margin:0;">Nhi·ªát ƒë·ªô üå°Ô∏è</p>
            <h2 style="margin:5px 0 0;">28¬∞C</h2>
           </div>

          <div class="metric-card" style="width:100%; background: linear-gradient(135deg, #bebccf, #90a090); text-align:center; cursor:pointer;" onclick="toggleSchedulePanel()">
             <h3 style="margin:0 0 5px;">L·ªãch Tr√¨nh T·ª± ƒê·ªông ‚è±Ô∏è</h3>
             <p id="nextScheduleText" style="margin:0;">ƒêang B·∫≠t | L·∫ßn t·ªõi: --:--</p>
            </div>
        </div>

    <div id="responseBox" style="margin-top:10px; text-align:center; font-size:12px; color:#888;"></div>

  </div>


  
</div>

<div id="schedulePanel" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); width:90%; max-width:400px; background:#e0f7ff; border-radius:0px; padding:15px; box-shadow:0 4px 15px rgba(0,0,0,0.3); z-index:999;">
  
  <h3 style="text-align:center; color:#006699;">Qu·∫£n L√Ω L·ªãch T∆∞·ªõi</h3>
  <div class="schedule-list" id="scheduleList"></div>
  <div class="add-form" style="display:flex; gap:5px; margin-top:10px;">
    <input type="time" id="timeInput">

    <input type="number" id="durationInput" placeholder="Ph√∫t">

    <button onclick="addSchedule()" style="padding:5px 10px; border-radius:0px; background:#0099cc; color:white; border:none; cursor:pointer;">Th√™m</button>
  </div>

  <div style="text-align:center; margin-top:10px;">
    <button onclick="sendSchedulesToEsp()" 
            style="padding:5px 10px; border-radius:0px; background:#28a745; color:white; border:none; cursor:pointer;">
        G·ª≠i/C·∫≠p nh·∫≠t L·ªãch
    </button>
    
    <button onclick="clearAllSchedules()" 
            style="padding:5px 10px; border-radius:0px; background:#f0ad4e; color:white; border:none; cursor:pointer; margin-left:10px;">
        X√≥a H·∫øt
    </button>
    
    <button onclick="closeSchedulePanel()" 
            style="padding:5px 10px; border-radius:0px; background:#ff6600; color:white; border:none; cursor:pointer;">
        ƒê√≥ng
    </button>
  </div>
</div>

<script>
// ƒê·ªãa ch·ªâ Worker v√† PINs

const WORKER_URL = "https://blynk-token-proxy.tanthanhlttb123.workers.dev";


const VIRTUAL_PIN_ONOFF = "V1"; // Pin B·∫≠t/T·∫Øt tr·ª±c ti·∫øp
const VIRTUAL_PIN_SCHEDULE = "V2"; // Pin cho c·∫•u h√¨nh l·ªãch tr√¨nh JSON
const MAX_SLOTS = 6;


/* ---------------- LOGIC ON/OFF V√Ä K·∫æT N·ªêI WORKER ---------------- */

/* ---------------- LOGIC ON/OFF V√Ä K·∫æT N·ªêI WORKER ---------------- */

// === ƒê·ªåC C·ªú QUY·ªÄN T·ª™ LOCAL STORAGE ===
const isAdmin = localStorage.getItem('isAdmin') === 'true'; 
const isUserAllowedToWrite = isAdmin; // Ch·ªâ Admin ƒë∆∞·ª£c GHI

console.log(`[QUY·ªÄN T∆Ø·ªöI C√ÇY] B·∫°n l√† Admin: ${isAdmin}. ƒê∆∞·ª£c ph√©p GHI l·ªánh: ${isUserAllowedToWrite}`);
// =======================================

let currentState = 0;



// C·∫≠p nh·∫≠t UI theo tr·∫°ng th√°i
function updateUI(state){
    const waterStatusText = document.getElementById("waterStatusText");
    const waterImage = document.getElementById("water-image");
    const waterBtn = document.getElementById("waterBtn");

    if(state===1){
        waterStatusText.innerText='B·∫¨T';
        waterStatusText.style.color='#4CAF50';
        //waterImage.src='img/cay_on.jpg';
        waterBtn.innerText='ON';
        waterBtn.style.backgroundColor='#4CAF50';
    } else {
        waterStatusText.innerText='T·∫ÆT';
        waterStatusText.style.color='gray';
        //waterImage.src='img/cay_off.jpg';
        waterBtn.innerText='OFF';
        waterBtn.style.backgroundColor='gray';
    }
    currentState = state;
}

// G·ª≠i l·ªánh l√™n Worker (H√†m M·ªöI: ph·∫£i c√≥ pin v√† value)
async function sendCommand(pin, commandValue){
    const responseBox = document.getElementById("responseBox");

    if (!isUserAllowedToWrite) {
        // Cho Kh√°ch th·∫•y giao di·ªán thay ƒë·ªïi (demo)
        if (pin === VIRTUAL_PIN_ONOFF) {
            updateUI(commandValue);
        }
        
        responseBox.textContent = "‚ùå (Kh√°ch Demo b·ªã ch·∫∑n l·ªánh)";
        responseBox.style.color = "red";
        return; // CH·∫∂N L·ªÜNH G·ª¨I ƒêI
    }
    try{
        // ƒêi·ªÅu ch·ªânh URL ƒë·ªÉ ch·∫•p nh·∫≠n pin

  

        const res = await fetch(`${WORKER_URL}?action=update&pin=${pin}&value=${commandValue}&device=cay`); 


        if(res.ok){
            responseBox.textContent = `‚úÖ L·ªánh g·ª≠i th√†nh c√¥ng (Pin ${pin}): ${commandValue}`;
            responseBox.style.color = "green";
            if (pin === VIRTUAL_PIN_ONOFF) {
                updateUI(commandValue);
            }
        } else {
            const errorText = await res.text();
            responseBox.textContent = `‚ùå L·ªói k·∫øt n·ªëi: ${res.status}. ${errorText}`;
            responseBox.style.color="red";
        }
    } catch (error){
        responseBox.textContent = "‚ö†Ô∏è L·ªói: Kh√¥ng th·ªÉ k·∫øt n·ªëi v·ªõi Worker";
        responseBox.style.color="orange";
    }
}

// N√∫t b·∫≠t/t·∫Øt th·ª±c t·∫ø (ƒê√£ s·ª≠a l·∫°i c√∫ ph√°p g·ªçi sendCommand)
/*
function toggleWater(){
    if(currentState===1){
        sendCommand(VIRTUAL_PIN_ONOFF, 0); // t·∫Øt
    } else {
        sendCommand(VIRTUAL_PIN_ONOFF, 1); // b·∫≠t
    }
}
    */



function toggleWater(){
    const waterVideo = document.querySelector("#waterVideo");
    
    // T√≠nh to√°n tr·∫°ng th√°i ti·∫øp theo (0 ho·∫∑c 1)
    const nextState = currentState === 1 ? 0 : 1; 

    // üî• C·∫¨P NH·∫¨T GIAO DI·ªÜN V√Ä VIDEO NGAY L·∫¨P T·ª®C (D√π l√† Admin hay Kh√°ch)
    // Vi·ªác n√†y l√†m cho n√∫t ph·∫£n h·ªìi NHANH nh∆∞ demo
    updateUI(nextState); 
    if(nextState === 1) waterVideo.play();
    else waterVideo.pause();

    // G·ªçi l·ªánh g·ª≠i ƒëi. L·ªánh n√†y s·∫Ω b·ªã ch·∫∑n n·∫øu l√† Kh√°ch (nh∆∞ng UI ƒë√£ c·∫≠p nh·∫≠t r·ªìi)
    sendCommand(VIRTUAL_PIN_ONOFF, nextState); 
}






// L·∫•y tr·∫°ng th√°i hi·ªán t·∫°i t·ª´ Worker
async function getStatus() {
    const responseBox = document.getElementById("responseBox");
    responseBox.textContent = "ƒêang t·∫£i tr·∫°ng th√°i hi·ªán t·∫°i...";
    responseBox.style.color = "gray";

    try {
        // ƒê√£ s·ª≠a URL ƒë·ªÉ ch·ªâ d√πng VIRTUAL_PIN_ONOFF (V1)

        const res = await fetch(`${WORKER_URL}?action=get&pin=${VIRTUAL_PIN_ONOFF}&device=cay`); 
          if(res.ok){
            const rawValue = await res.text();
            const cleanValue = rawValue.replace(/[^0-9]/g, '');
            const state = cleanValue === '1' ? 1 : 0;
            updateUI(state);
            responseBox.textContent = `ƒê·ªçc ƒë∆∞·ª£c: ${state}`;
            responseBox.style.color="green";
            if (state === 1) {
                waterVideo.play();
            } else {
                waterVideo.pause();
            }

        } else {
            responseBox.textContent = `‚ùå L·ªói ƒë·ªçc tr·∫°ng th√°i: ${res.status}`;
            responseBox.style.color="red";
        }
    } catch (error){
        responseBox.textContent = "‚ö†Ô∏è L·ªói k·∫øt n·ªëi ho·∫∑c timeout";
        responseBox.style.color="orange";
    }
}

// Load tr·∫°ng th√°i khi m·ªü trang
//window.onload = getStatus;


/* ---------------- LOGIC L·ªäCH TR√åNH T·ª∞ ƒê·ªòNG (6 SLOTS) ---------------- */

let schedules = JSON.parse(localStorage.getItem('schedules') || '[]');
// let timerInterval; // Kh√¥ng c·∫ßn thi·∫øt v√¨ ESP x·ª≠ l√Ω h·∫πn gi·ªù

// --- 1. Kh·ªüi t·∫°o/Chu·∫©n h√≥a 6 Slot ---
function initializeSchedules() {
    let newSchedules = [];
    for (let i = 0; i < MAX_SLOTS; i++) {
        const existing = schedules.find(s => s.id === (i + 1));
        if (existing) {
            newSchedules.push(existing);
        } else {
            newSchedules.push({ id: i + 1, hour: 0, min: 0, duration: 0, active: false });
        }
    }
    schedules = newSchedules;
    localStorage.setItem('schedules', JSON.stringify(schedules));
}
initializeSchedules();


// --- 2. Render danh s√°ch h·∫πn gi·ªù ---
function renderSchedules() {
    const list = document.getElementById("scheduleList");
    list.innerHTML = "";
    
    // S·∫Øp x·∫øp c√°c slot ƒë√£ active l√™n tr√™n
    const sortedSchedules = [...schedules].sort((a,b) => (b.active ? -1 : a.id - b.id)); // S·∫Øp x·∫øp active l√™n ƒë·∫ßu

    sortedSchedules.forEach((s) => {
        const item = document.createElement("div");
        item.style.display = "flex";
        item.style.justifyContent = "space-between";
        item.style.padding = "5px 0";
        
        if(s.active){
            // Hi·ªÉn th·ªã l·ªãch tr√¨nh ƒëang active
            item.innerHTML = `<span>Slot ${s.id}: ${String(s.hour).padStart(2,'0')}:${String(s.min).padStart(2,'0')} (${s.duration} ph√∫t)</span>
                <button onclick="deleteSchedule(${s.id})" style="background:#ff4444; color:white; border:none; border-radius:0px; cursor:pointer;">X√≥a</button>`;
        } else {
            // Hi·ªÉn th·ªã slot tr·ªëng
            item.innerHTML = `<span style="color:gray;">Slot ${s.id}: (Tr·ªëng)</span>`;
        }
        list.appendChild(item);
    });
}


// --- 3. Th√™m H·∫πn gi·ªù (Ch·ªâ th√™m v√†o slot R·ªñNG ƒë·∫ßu ti√™n) ---
function addSchedule() {

    // üî• CH·∫∂N KH√ÅCH TH√äM L·ªäCH
    if (!isUserAllowedToWrite) {
        alert("‚ùå B·∫°n l√† Kh√°ch Demo. Kh√¥ng th·ªÉ Th√™m L·ªãch Tr√¨nh T·ª± ƒê·ªông.");
        return; 
    }
    const timeInput = document.getElementById("timeInput").value;
    const duration = parseInt(document.getElementById("durationInput").value) || 1;
    if (!timeInput) return alert("Ch·ªçn gi·ªù!");
    if (duration <= 0) return alert("Th·ªùi l∆∞·ª£ng ph·∫£i l·ªõn h∆°n 0!");
    
    const emptySlot = schedules.find(s => s.active === false);
    
    if (emptySlot) {
        const [hour, min] = timeInput.split(":").map(Number);
        emptySlot.hour = hour;
        emptySlot.min = min;
        emptySlot.duration = duration;
        emptySlot.active = true;
        
        localStorage.setItem('schedules', JSON.stringify(schedules));
       
       
        renderSchedules();
        updateNextScheduleUI();
       
        document.getElementById("timeInput").value = "";
        document.getElementById("durationInput").value = 1;
        
        // G·ª≠i ngay sau khi th√™m
       // sendSchedulesToEsp();
    } else {
        alert("ƒê√£ ƒë·∫°t gi·ªõi h·∫°n t·ªëi ƒëa 6 l·∫ßn h·∫πn gi·ªù!");
    }
}


// --- 4. X√≥a 1 l·∫ßn h·∫πn gi·ªù (ƒê·∫∑t slot v·ªÅ tr·∫°ng th√°i R·ªñNG/Inactive) ---
function deleteSchedule(id_to_delete) {

    // üî• CH·∫∂N KH√ÅCH X√ìA L·ªäCH
    if (!isUserAllowedToWrite) {
        alert("‚ùå B·∫°n l√† Kh√°ch Demo. Kh√¥ng th·ªÉ X√≥a L·ªãch Tr√¨nh.");
        return; 
    }
    if(!confirm(`B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a l·ªãch tr√¨nh Slot ${id_to_delete} n√†y kh√¥ng?`)){
        return;
    }
    const index = schedules.findIndex(s => s.id === id_to_delete);
    if (index !== -1) {
        schedules[index].hour = 0;
        schedules[index].min = 0;
        schedules[index].duration = 0;
        schedules[index].active = false;
        
        localStorage.setItem('schedules', JSON.stringify(schedules));
        renderSchedules();
        updateNextScheduleUI();
        
        sendSchedulesToEsp(); 
    }
}


// --- 5. B·ªï sung n√∫t X√ìA H·∫æT ---
function clearAllSchedules() {

    // üî• CH·∫∂N KH√ÅCH X√ìA H·∫æT L·ªäCH
    if (!isUserAllowedToWrite) {
        alert("‚ùå B·∫°n l√† Kh√°ch Demo. Kh√¥ng th·ªÉ X√≥a H·∫øt L·ªãch Tr√¨nh.");
        return; 
    }
    if(!confirm("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën X√ìA H·∫æT t·∫•t c·∫£ 6 L·ªäCH TR√åNH?")){
        return;
    }
    
    schedules.forEach(s => {
        s.hour = 0;
        s.min = 0;
        s.duration = 0;
        s.active = false;
    });

    localStorage.setItem('schedules', JSON.stringify(schedules));
    renderSchedules();
    updateNextScheduleUI();
    
    sendSchedulesToEsp();
}


// --- 6. G·ª≠i L·ªãch xu·ªëng ESP (T·∫°o v√† g·ª≠i chu·ªói JSON qua V2) ---
function sendSchedulesToEsp() {
    const schedulesToSend = schedules
        .map(s => ({
            id: s.id, 
            h: s.hour, 
            m: s.min, 
            d: s.duration,
            a: s.active 
        }));
        
    const jsonString = JSON.stringify(schedulesToSend);
    
    // G·ª≠i chu·ªói JSON qua VIRTUAL_PIN_SCHEDULE (V2)
    sendCommand(VIRTUAL_PIN_SCHEDULE, jsonString);
}


// --- 7. C·∫≠p nh·∫≠t UI nh·ªè (L·ªãch tr√¨nh g·∫ßn nh·∫•t) ---
function updateNextScheduleUI() {
    const nextText = document.getElementById("nextScheduleText");
    
    // Ch·ªâ l·∫•y l·ªãch ƒëang active
    const activeSchedules = schedules.filter(s => s.active); 

    if (activeSchedules.length > 0) {
        // T√¨m l·ªãch g·∫ßn nh·∫•t trong t∆∞∆°ng lai (T·∫°m th·ªùi logic ƒë∆°n gi·∫£n: ch·ªâ s·∫Øp x·∫øp theo gi·ªù/ph√∫t)
        const upcoming = activeSchedules.sort((a,b)=>{
            if(a.hour!==b.hour) return a.hour-b.hour;
            return a.min-b.min;
        })[0];
        
        nextText.textContent = `ƒêang B·∫≠t | L·∫ßn t·ªõi: ${String(upcoming.hour).padStart(2,'0')}:${String(upcoming.min).padStart(2,'0')}`;
    } else {
        nextText.textContent = `ƒêang T·∫ÆT | Ch∆∞a c√≥ h·∫πn`;
    }
}

// Hi·ªÉn th·ªã/ƒê√≥ng Panel
function toggleSchedulePanel(){
    const panel = document.getElementById("schedulePanel");
    panel.style.display = panel.style.display==="none" ? "block" : "none";
    renderSchedules();
}
function closeSchedulePanel(){
    document.getElementById("schedulePanel").style.display="none";
    updateNextScheduleUI();
}

// Kh·ªüi t·∫°o tr·∫°ng th√°i ban ƒë·∫ßu
updateNextScheduleUI();

// Ch·ªâ load 1 l·∫ßn khi m·ªü trang dk_cay
if (!window.weatherLoaded && window.location.pathname.includes("dk_cay")) {
    window.weatherLoaded = true; // ƒë√°nh d·∫•u ƒë√£ load

    const key = "1fdabbeeb08ef9825b4fa9897d233d19"; // Thay b·∫±ng API key th·∫≠t c·ªßa b·∫°n
    const city = "Da Nang";     // T√™n th√†nh ph·ªë

    fetch(`https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${key}&units=metric&lang=vi`)
        .then(response => response.json())
        .then(data => {
            // L·∫•y t·∫•t c·∫£ th·∫ª .metric-card
            const cards = document.querySelectorAll(".metric-card");
            if (cards.length >= 2) {
                // Gi·∫£ s·ª≠ th·∫ª ƒë·∫ßu l√† ƒê·ªô ·∫©m, th·∫ª th·ª© 2 l√† Nhi·ªát ƒë·ªô
                cards[0].querySelector("h2").textContent = data.main.humidity + "%";
                cards[1].querySelector("h2").textContent = data.main.temp + "¬∞C";
            }
        })
        .catch(err => console.error("L·ªói l·∫•y th·ªùi ti·∫øt:", err));
}

</script>
</body>
</html>


