<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Aptomat Control</title>
<style>
  body {
    background-color: #121212;
    color: white;
    font-family: Arial, sans-serif;
    text-align: center;
    padding-top: 40px;
  }
  h2 { margin-bottom: 20px; }
  .control-section {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 25px;
    margin-bottom: 25px;
  }
  #btn {
    font-size: 24px;
    padding: 20px 60px;
    border: none;
    border-radius: 12px;
    color: white;
    cursor: pointer;
    transition: 0.3s;
  }
  .on { background-color: #00c853; }
  .off { background-color: #555; }
  #checkBtn {
    background-color: #2196f3;
    border: none;
    border-radius: 8px;
    color: white;
    font-size: 18px;
    padding: 12px 25px;
    cursor: pointer;
  }
  #statusSection { margin-top: 10px; }
  #circle {
    width: 30px; height: 30px;
    border-radius: 50%;
    display: inline-block;
    margin-left: 10px;
    vertical-align: middle;
    background-color: #555;
    box-shadow: 0 0 8px #222;
  }
 .circle-on { background-color: #00c853 !important; box-shadow: 0 0 15px #00e676; }
  .circle-off { background-color: #333 !important; box-shadow: 0 0 5px #111; }
.circle-off {
  background-color: #333 ;
  box-shadow: 0 0 5px #111 ;
}

  #bepImage {
    width: 80%;
    max-width: 600px;
    border-radius: 10px;
    margin-top: 25px;
    box-shadow: 0 0 15px #000;
  }
  #responseBox {
    margin-top: 20px;
    padding: 10px;
    border: 1px solid #fff;
    width: 300px;
    margin-left: auto;
    margin-right: auto;
    font-weight: bold;
  }
</style>
</head>
<body>

<h2>‚ö° Aptomat Web Control</h2>

<div class="control-section">
  <button id="checkBtn" onclick="getStatus()">Xem tr·∫°ng th√°i</button>
  <button id="btn" class="off" onclick="toggle()">OFF</button>
</div>

<div id="statusSection">
  <span id="circle" class="circle-off"></span>
  <span id="statusText">CB OFF</span>
 
</div>

<img id="bepImage" src="bep_off.jpg" alt="H√¨nh b·∫øp">

<div id="responseBox">Ph·∫£n h·ªìi s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y</div>

<script>
const TOKEN = "rum78doJsOjCNQ6heXtKLS1WonPOhcH_"; 
const API_BASE = "https://blynk.cloud/external/api";

// üîò Nh·∫•n n√∫t ON/OFF
async function toggle() {
  const btn = document.getElementById("btn");
  const newState = btn.textContent === "OFF" ? 1 : 0;
  const responseBox = document.getElementById("responseBox");

  responseBox.textContent = "ƒêang g·ª≠i l·ªánh...";

  try {
    const res = await fetch(`${API_BASE}/update?token=${TOKEN}&V1=${newState}`);

    if (res.ok) {
      responseBox.textContent = "‚úÖ H·ª£p l·ªá (200 OK)";
      syncUI(newState === 1);
    } else {
      responseBox.textContent = "‚ö† Kh√¥ng h·ª£p l·ªá (" + res.status + ")";
    }
  } catch (e) {
    responseBox.textContent = "‚ùå L·ªói k·∫øt n·ªëi!";
    console.error(e);
  }
}

// üîÑ Khi nh·∫•n ‚ÄúXem tr·∫°ng th√°i‚Äù
async function getStatus() {
  try {
    const res = await fetch(`${API_BASE}/get?token=${TOKEN}&V1`);
    const value = await res.text();
    const isOn = value.trim() === "1";
    updateStatus(isOn);
    updateImage(isOn);

    const btn = document.getElementById("btn");
    const btnIsOn = btn.textContent === "ON";
    if (isOn !== btnIsOn) updateButton(isOn);

  } catch (e) {
    console.error("L·ªói ƒë·ªçc tr·∫°ng th√°i:", e);
  }
}

// ‚úÖ ƒê·ªìng b·ªô giao di·ªán sau khi g·ª≠i l·ªánh
function syncUI(isOn) {
  updateButton(isOn);
  updateStatus(isOn);
  updateImage(isOn);
}

// üü¢ C·∫≠p nh·∫≠t n√∫t ON/OFF
function updateButton(isOn) {
  const btn = document.getElementById("btn");
  if (isOn) {
    btn.textContent = "ON";
    btn.classList.remove("off");
    btn.classList.add("on");
  } else {
    btn.textContent = "OFF";
    btn.classList.remove("on");
    btn.classList.add("off");
  }
}










// üîµ C·∫≠p nh·∫≠t v√≤ng tr√≤n + ch·ªØ
function updateStatus(isOn) {
  const circle = document.getElementById("circle");
  const text = document.getElementById("statusText");
  circle.classList.remove("circle-on", "circle-off");

  circle.classList.remove("circle-on","circle-off");
  circle.classList.add(isOn ? "circle-on" : "circle-off");

 
  if (isOn) {
    

   




    text.textContent = "CB ON";
  } else {

  




    
    text.textContent = "CB OFF";
  }
}

// üü† C·∫≠p nh·∫≠t h√¨nh b·∫øp
function updateImage(isOn) {
  const img = document.getElementById("bepImage");
  img.src = isOn ? "bep_on.jpg" : "bep_off.jpg";
}
</script>

</body>
</html>
