<!doctype html>

<html lang="vi">

<head>

<script>
    // B·∫¢O V·ªÜ: N·∫øu ch∆∞a ƒëƒÉng nh·∫≠p, chuy·ªÉn h∆∞·ªõng v·ªÅ index.html (ƒê√É S·ª¨A)
    if (localStorage.getItem('isLoggedIn') !== 'true') {
        window.location.replace('index.html'); // <<< S·ª¨A T·∫†I ƒê√ÇY
    }
</script>



<meta charset="utf-8" />

<meta name="viewport" content="width=device-width,initial-scale=1" />

<title>Demo Mobile App T@ Smart</title>

<script src="https://cdn.tailwindcss.com"></script>

<link rel="stylesheet" href="css/style.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
   

</head>



<body>





<script>
    // 1. N·∫øu ch∆∞a login ‚Üí quay v·ªÅ index.html (ƒê√É S·ª¨A)
    if (localStorage.getItem('isLoggedIn') !== 'true') {
        window.location.replace('index.html'); // <<< S·ª¨A T·∫†I ƒê√ÇY
    }

    // 2. Logout: c≈©ng s·ª≠a link chuy·ªÉn h∆∞·ªõng
    const logoutBtn = document.getElementById('logoutBtn');
    if(logoutBtn){
        logoutBtn.addEventListener('click', () => {
            // ...
            window.location.href = "index.html"; // <<< S·ª¨A T·∫†I ƒê√ÇY
        });
    }
</script>









<div class="wrap">

  <div class="viewport">



    <!-- Trang ƒëƒÉng nh·∫≠p -->


   

      


    <!-- Trang ch√≠nh -->
    <section id="page-home" class="page center" style="background:linear-gradient(180deg,#A8C9E4,#FFFFFF)">
        <header class="top">
        <div class="home-brand">
            <div class="home-logo">T@</div>
            <div class="home-title">Nh√† c·ªßa T@</div>
        </div>
        <div class="chip">Qu·∫£n tr·ªã</div>
    </header>

    <main style="padding:0 6px 100px 6px">
        <div class="control-card">
            <div class="control-left">
                <div class="control-title">B·∫øp ƒêi·ªán</div>
                <div class="control-desc" style="margin-bottom: 12px;">
                    Tr·∫°ng th√°i: <span id="stove">T·∫Øt</span>
                </div>

                <div class="control-actions-group">
                    <div class="control-actions">
                        <button id="btn-turn-on" class="small-btn on" onclick="turnOn()">M·ªû</button>
                        <button id="btn-turn-off" class="small-btn off" onclick="turnOff()">T·∫ÆT</button>
                    </div>
                    <div id="responseBox"></div>
                </div>

                <div class="status-control-row">
                    <button onclick="getStatus()" class="small-btn view-status-btn off">Xem</button>
                    <div class="cb-display">
                        <span>CB:</span>
                        <div id="cb-status" class="cb-dot"></div>
                    </div>
                </div>
            </div>





   <div id="imgBep" class="control-thumb">
    <video id="video-on" src="img/aptomat_on.mp4" preload="auto" style="display:none; width:100%; height:100%; object-fit:contain;" playsinline></video>
    <video id="video-off" src="img/aptomat_off.mp4" preload="auto" style="display:block; width:100%; height:100%; object-fit:contain;" playsinline></video>
    <video id="video-on2" src="img/aptomat_on2.mp4" preload="auto" style="display:none; width:100%; height:100%; object-fit:contain;" playsinline></video>
    <video id="video-off2" src="img/aptomat_off2.mp4" preload="auto" style="display:none; width:100%; height:100%; object-fit:contain;" playsinline></video>
</div>



       
       
        </div>

        <div class="thumbs">
            

<a class="thumb" href="dk_cay.html">
    <div class="thumb-logo">
        <i class="fa-solid fa-water-ladder text-blue-500"></i>
    </div> 
    <div class="img bg-tuoi"></div>
    <h4></h4>
    <p>Ki·ªÉu </p>
</a>











<div class="thumb" onclick="goto('page-rem')">
    <div class="thumb-logo">
        <i class="fa-solid fa-house-chimney-window text-indigo-500"></i>
    </div>
    <div class="img-rem"></div>
    <h4></h4>
    <p>ki·ªÉu</p>
</div>



            <div class="thumb" onclick="goto('page-aptomat')">
                <div class="thumb-logo"><i class="fa-solid fa-bolt text-yellow-500"></i></div>
                <div class="img bg-apt"></div>
                <h4></h4>
                <p>Ngu·ªìn ch√≠nh</p>
            </div>



            <div class="thumb" onclick="goto('page-quangcao')">
                <div class="thumb-logo"><i class="fa-solid fa-bag-shopping text-pink-500"></i></div>
                <div class="img bg-prod"></div>
                <h4></h4>
                <p>Ki·ªÉu</p>
            </div>



           

          <a class="thumb" href="https://alfred.camera/" target="_blank">
 <div class="thumb-logo"><i class="fa-solid fa-video text-gray-700"></i></div>
 <div class="img bg-cam"></div>
<h4></h4>
 <p>S√¢n th∆∞·ª£ng</p>
</a>






<a class="thumb" href="dk_den.html">
    <div class="thumb-logo">
        <i class="fa-solid fa-water-ladder text-blue-500"></i>
    </div> 
    <div class="img bg-light"></div>
    <h4></h4>
    <p>Ki·ªÉu </p>
</a>




            
        </div>
    </main>

    <div class="bottombar">
        <div class="navbtn">
            <i class="fa-solid fa-house"></i> <span>Trang Ch·ªß</span> </div>
        <div class="navbtn" onclick="goto('page-quangcao')">
            <i class="fa-solid fa-video"></i> <span>Video</span> </div>


              <div class="navbtn" onclick="goto('page-notification')">
        <i class="fa-solid fa-bell"></i>
        <span>B√°o ƒë·ªông</span>
    </div>
        <div class="navbtn" onclick="logout()">
            <i class="fa-solid fa-arrow-right-from-bracket"></i> <span>ƒêƒÉng Xu·∫•t</span> </div>
    </div>
</section>



































    <!-- C√°c trang kh√°c -->

    




















<section id="page-rem" class="page hidden">
    <div class="sub-header">
        <div class="back" onclick="back()"> 
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M15 18l-6-6 6-6"/>
            </svg>
        </div>
        <h3>C√°c lo·∫°i c√¢y thu·ªëc</h3> 
    </div>

    <main style="padding:0 6px 100px 6px">
        <div class="thumbs">
            
            <div class="thumb" 
                 data-name="C√¢y Chay" 
                 data-desc="M√¥ t·∫£ c√¥ng d·ª•ng C√¢y Chay: Ch·ªØa c√°c b·ªánh v·ªÅ rƒÉng mi·ªáng, ƒëau nh·ª©c x∆∞∆°ng kh·ªõp v√† c√≥ th·ªÉ d√πng l√†m thu·ªëc b·ªï.">
                <img src="img/caychay.jpg" alt="C√¢y Chay" onclick="goToDetailPage(this)"/>
                <p>Ki·ªÉu C√¢y Chay</p>
            </div>

            <div class="thumb" 
                 data-name="Hoa thi√™n l√Ω" 
                 data-desc="M√¥ t·∫£ c√¥ng d·ª•ng Hoa Thi√™n L√Ω: D√πng ƒë·ªÉ an th·∫ßn, ch·ªØa m·∫•t ng·ªß v√† b·ªìi b·ªï c∆° th·ªÉ.">
                <img src="img/thienly.jpg" alt="Hoa thi√™n l√Ω" onclick="goToDetailPage(this)"/>
                <p>Hoa thi√™n l√Ω</p>
            </div>
            
            <div class="thumb" 
                 data-name="H√† th·ªß √¥" 
                 data-desc="M√¥ t·∫£ c√¥ng d·ª•ng H√† Th·ªß √î: C√≥ t√°c d·ª•ng b·ªï m√°u, tr·ªã suy nh∆∞·ª£c th·∫ßn kinh, v√† l√†m ƒëen t√≥c.">
                <img src="img/hathuo.jpg" alt="H√† th·ªß √¥" onclick="goToDetailPage(this)"/>
                <p>H√† th·ªß √¥</p>
            </div>
            
            <div class="thumb" 
                 data-name="ƒêan s√¢m" 
                 data-desc="M√¥ t·∫£ c√¥ng d·ª•ng ƒêan S√¢m: ƒê∆∞·ª£c d√πng ƒë·ªÉ ho·∫°t huy·∫øt, tr·ª•c ·ª©, tr·ªã kinh nguy·ªát kh√¥ng ƒë·ªÅu v√† c√°c b·ªánh tim m·∫°ch.">
                <img src="img/dan_sam.jpg" alt="ƒêan s√¢m" onclick="goToDetailPage(this)"/>
                <p>ƒêan s√¢m</p>
            </div>
            
            <div class="thumb" 
                 data-name="C√¢y r√°y gai" 
                 data-desc="M√¥ t·∫£ c√¥ng d·ª•ng C√¢y R√°y Gai: Th∆∞·ªùng d√πng ƒë·ªÉ ch·ªØa phong th·∫•p, ƒëau nh·ª©c x∆∞∆°ng kh·ªõp. (C·∫©n th·∫≠n khi d√πng, c·∫ßn ch·∫ø bi·∫øn k·ªπ).">
                <img src="img/ray_gai.jpg" alt="C√¢y r√°y gai" onclick="goToDetailPage(this)"/>
                <p>C√¢y r√°y gai</p>
            </div>

            <div class="thumb" 
                 data-name="C√¢y m·∫≠t g·∫•u" 
                 data-desc="M√¥ t·∫£ c√¥ng d·ª•ng C√¢y M·∫≠t G·∫•u: Gi√∫p thanh nhi·ªát, gi·∫£i ƒë·ªôc, h·ªó tr·ª£ ti√™u h√≥a v√† gan m·∫≠t.">
                <img src="img/matgau.jpg" alt="C√¢y m·∫≠t g·∫•u" onclick="goToDetailPage(this)"/>
                <p>C√¢y m·∫≠t g·∫•u</p>
            </div>
            
            <div class="thumb" 
                 data-name="S√¢m cau" 
                 data-desc="M√¥ t·∫£ c√¥ng d·ª•ng S√¢m Cau: D√πng ƒë·ªÉ √¥n th·∫≠n, tr√°ng d∆∞∆°ng, ƒëi·ªÅu tr·ªã ƒëau l∆∞ng m·ªèi g·ªëi v√† c√°c ch·ª©ng suy nh∆∞·ª£c.">
                <img src="img/samcau.jpg" alt="S√¢m cau" onclick="goToDetailPage(this)"/>
                <p>S√¢m cau</p>
            </div>

            <div class="thumb" 
                 data-name="C√† gai leo" 
                 data-desc="M√¥ t·∫£ c√¥ng d·ª•ng C√† Gai Leo: ƒê∆∞·ª£c d√πng ƒë·ªÉ gi·∫£i ƒë·ªôc gan, h·ªó tr·ª£ ƒëi·ªÅu tr·ªã vi√™m gan B v√† tƒÉng c∆∞·ªùng ch·ª©c nƒÉng gan.">
                <img src="img/ca_gai_leo.jpg" alt="C√† gai leo"onclick="goToDetailPage(this)"/>
                <p>C√† gai leo</p>
            </div>

        </div>
    </main>
    
   
</section>






<section id="page-detail" class="page hidden">
    <div class="sub-header">
        <div class="back" onclick="showPage('page-rem', 'right')"> 
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M15 18l-6-6 6-6"/>
            </svg>
        </div>
        <h3 id="detail-plant-name"></h3> 
    </div>

    <main style="padding: 20px 20px 100px 20px;">
        <div class="detail-container">
            <img id="detail-image" src="" alt="C√¢y thu·ªëc chi ti·∫øt" class="full-width-image" />

            <div class="detail-content">
                <h4 class="content-title">C√¥ng D·ª•ng v√† M√¥ T·∫£</h4>
                <p id="detail-description">N·ªôi dung m√¥ t·∫£ chi ti·∫øt s·∫Ω ƒë∆∞·ª£c ch√®n v√†o ƒë√¢y.</p>
                <button class="download-btn" onclick="downloadDetailPageImage()">T·∫£i ·∫£nh</button>
            </div>
        </div>
    </main>
</section>













   <section id="page-aptomat" class="page hidden">
    <div class="sub-header">
        <div class="back" onclick="back()">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 18l-6-6 6-6"/></svg>
        </div>
        <h3>√Åp-t√¥-m√°t</h3>
    </div>
    <div class="sub-card">
        <p>ƒêi·ªÅu khi·ªÉn ngu·ªìn ƒëi·ªán ch√≠nh.</p>
        <button class="big-toggle" onclick="setApt(true)">B·∫¨T √ÅP T√î M√ÅT</button>
        <button class="big-toggle" style="margin-top: 10px;" onclick="setApt(false)">T·∫ÆT √ÅP T√î M√ÅT</button>
    </div>
</section>
    <section id="page-quangcao" class="page hidden">
    <div class="sub-header">
        <div class="back" onclick="back()">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 18l-6-6 6-6"/></svg>
        </div>
        <h3>S·∫£n ph·∫©m / Video</h3>
    </div>
    <div class="sub-card">
        <p>Trang n√†y hi·ªÉn th·ªã n·ªôi dung qu·∫£ng c√°o.</p>
        <p class="muted">B·∫°n c√≥ th·ªÉ nh√∫ng video YouTube v√†o ƒë√¢y.</p>
    </div>
</section>




 <section id="page-camera" class="page hidden">
    <div class="sub-header">
        <div class="back" onclick="back()">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 18l-6-6 6-6"/></svg>
        </div>
        <h3>Camera S√¢n Th∆∞·ª£ng</h3>
    </div>
    <div class="sub-card" style="height: auto; padding: 0 10px 10px 10px;"> 
        <iframe 
            src="https://alfred.camera/" 
            id="alfred-viewer"
            style="width: 100%; height: 80vh; border: 1px solid #ccc; border-radius: 8px; overflow: hidden;" 
            title="Alfred Camera Viewer"
        >
            Tr√¨nh duy·ªát c·ªßa b·∫°n kh√¥ng h·ªó tr·ª£ iframe.
        </iframe>

        <p class="muted" style="margin-top: 10px; text-align: center;">
            üí° Vui l√≤ng ƒëƒÉng nh·∫≠p v√†o t√†i kho·∫£n Google Alfred c·ªßa b·∫°n.
        </p>
    </div>
</section>




















<section id="page-light" class="page hidden">
    <div class="sub-header">
        <div class="back" onclick="back()"> 
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 18l-6-6 6-6"/></svg>
        </div>
        <h3>ƒêi·ªÅu khi·ªÉn ƒê√®n</h3> 
    </div>
    <div class="sub-card">
       <p>Trang n√†y hi·ªÉn th·ªã n·ªôi dung qu·∫£ng c√°o.</p>
        <p class="muted">B·∫°n c√≥ th·ªÉ nh√∫ng video YouTube v√†o ƒë√¢y.</p>
    </div>
</section>

<section id="page-notification" class="page hidden">
    <div class="sub-header">
        <div class="back" onclick="goto('page-home')"><i class="fa-solid fa-chevron-left"></i></div>
        <h3>C·∫•u h√¨nh Telegram</h3>
    </div>
    <div class="sub-card" style="padding: 20px;">
    <p style="font-weight: bold;">Telegram Token:</p>
    <input type="text" id="user_tele_token" placeholder="Bot Token c·ªßa b·∫°n...">

    <p style="font-weight: bold;">Telegram Chat ID:</p>
    <input type="text" id="user_chat_id" placeholder="ID ng∆∞·ªùi nh·∫≠n...">

    <div style="margin: 15px 0; display: flex; align-items: center; gap: 10px;">
        <input type="checkbox" id="notify_checkbox" style="width: 20px; height: 20px;" checked>
        <label for="notify_checkbox" style="font-weight: bold; color: blue;">B·∫≠t th√¥ng b√°o chu√¥ng</label>
    </div>

    <button onclick="saveSmartConfig()" class="big-toggle" style="background: #2563eb; color: white; width: 100%; margin-bottom: 10px;">
        L∆ØU V√Ä C·∫¨P NH·∫¨T
    </button>

    <button onclick="clearForNewUser()" style="background: #dc2626; color: white; width: 100%; border: none; padding: 10px; border-radius: 8px; font-weight: bold; cursor: pointer;">
        X√ìA T·∫§T C·∫¢ (KHI B√ÄN GIAO M√ÅY)
    </button>
</div>
</section>



  </div>

</div>



<script src="js/app.js"></script>

<script>

     function goto(pageId) {
    console.log("ƒêang chuy·ªÉn t·ªõi trang:", pageId);
    // 1. ·∫®n t·∫•t c·∫£ c√°c trang
    document.querySelectorAll('.page').forEach(p => {
        p.classList.add('hidden');
        p.style.display = 'none';
    });
    // 2. Hi·ªán trang ƒë∆∞·ª£c ch·ªçn
    const target = document.getElementById(pageId);
    if (target) {
        target.classList.remove('hidden');
        target.style.display = 'block';
    } else {
        console.error("Kh√¥ng t√¨m th·∫•y trang c√≥ ID:", pageId);
    }
}

function back() { 
    goto('page-home'); 
}

// 1. H√†m l∆∞u v√† c·∫≠p nh·∫≠t tr·∫°ng th√°i √¥ vu√¥ng
async function saveSmartConfig() {
    const token = document.getElementById('user_tele_token').value.trim();
    const id = document.getElementById('user_chat_id').value.trim();
    const isChecked = document.getElementById('notify_checkbox').checked;
    const status = isChecked ? 'on' : 'off';

    const workerUrl = "https://blynk-token-proxy.tanthanhlttb123.workers.dev"; 
    const finalUrl = `${workerUrl}?from=web&action=saveConfig&teleToken=${token}&chatId=${id}&notify=${status}`;
    
    try {
        await fetch(finalUrl);
        alert(isChecked ? "üîî ƒê√£ b·∫≠t b√°o chu√¥ng!" : "üîï ƒê√£ t·∫Øt b√°o chu√¥ng!");
        document.getElementById('user_tele_token').value = ""; 
        document.getElementById('user_chat_id').value = "";
    } catch (e) { alert("‚ùå L·ªói k·∫øt n·ªëi!"); }
}

// 2. H√†m x√≥a s·∫°ch d·ªØ li·ªáu ƒë·ªÉ ƒë∆∞a cho ng∆∞·ªùi kh√°c
async function clearForNewUser() {
    if (confirm("B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a s·∫°ch m√£ Telegram ƒë·ªÉ b√†n giao m√°y cho ng∆∞·ªùi kh√°c kh√¥ng?")) {
        const workerUrl = "https://blynk-token-proxy.tanthanhlttb123.workers.dev";
        // G·ª≠i l·ªánh x√≥a (clear) l√™n Worker
        const finalUrl = `${workerUrl}?from=web&action=clearConfig`;
        
        try {
            const res = await fetch(finalUrl);
            if(res.ok) {
                alert("‚úÖ ƒê√£ x√≥a s·∫°ch d·ªØ li·ªáu! B·∫°n c√≥ th·ªÉ giao m√°y cho kh√°ch m·ªõi.");
            }
        } catch (e) { alert("‚ùå L·ªói x√≥a d·ªØ li·ªáu!"); }
    }
}
    // H√†m l∆∞u c·∫•u h√¨nh th√¥ng minh
// ƒê·ªïi t√™n h√†m th√†nh saveSmartConfig ƒë·ªÉ h·∫øt l·ªói "is not defined"

(function() {
    const originalSendCommand = window.sendCommand;
    if (typeof originalSendCommand === 'function') {
        window.sendCommand = async function(commandValue) {
            // L·∫•y th√¥ng tin ng∆∞·ªùi d√πng ƒë√£ l∆∞u
            const savedWorker = localStorage.getItem('user_worker_url');
            const tToken = localStorage.getItem('user_tele_token') || "";
            const tId = localStorage.getItem('user_chat_id') || "";

            // N·∫øu ng∆∞·ªùi d√πng ƒë√£ nh·∫≠p link m·ªõi, ta d√πng link ƒë√≥ thay cho WORKER_URL c≈©
            if (savedWorker) {
                const finalUrl = `${savedWorker}?action=update&pin=V1&value=${commandValue}&teleToken=${tToken}&chatId=${tId}&from=esp`;
                
                // Th·ª±c hi·ªán g·ª≠i l·ªánh (Ph·∫ßn n√†y thay th·∫ø fetch trong app.js c·ªßa b·∫°n)
                try {
                    updateUI(commandValue); // V·∫´n g·ªçi h√†m update video c·ªßa b·∫°n
                    const res = await fetch(finalUrl);
                    console.log("ƒê√£ g·ª≠i k√®m Telegram cho ng∆∞·ªùi d√πng m·ªõi!");
                } catch (e) {
                    console.error("L·ªói g·ª≠i l·ªánh k√®m Telegram:", e);
                }
            } else {
                // N·∫øu ch∆∞a nh·∫≠p g√¨, quay l·∫°i ch·∫°y h√†m c≈© c·ªßa b·∫°n
                return originalSendCommand(commandValue);
            }
        };
    }
})();

// T·ª± ƒë·ªông ƒëi·ªÅn l·∫°i th√¥ng tin c≈© khi m·ªü trang (cho ng∆∞·ªùi d√πng d·ªÖ s·ª≠a)

</script>



</body>
</html>
